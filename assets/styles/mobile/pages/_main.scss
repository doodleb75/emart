@use "../../abstracts/functions" as *;
@use "../../abstracts/mixins";
@use "../../abstracts/variables" as *;

// 모바일 메인 페이지 레이아웃 (Mobile Main Page Layout)

.main-page {
    margin-top: rem(8);
    padding-bottom: rem(80); // 하단 네비게이션 여백 (Bottom nav spacing)
    background-color: $white;
}

.section-wrapper {
    padding: rem(24) rem(0);

    &.section-divider {
        border-bottom: rem(8) solid $gray-50;
    }
}

.qty-box {
    input {
        height: calc(100% - rem(4));
        border-radius: rem(2);

        &:focus {
            outline: 2px solid $gray-700 !important;
        }
    }
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: rem(16);
    padding: rem(0) rem(16);

    .section-title {
        font-size: rem(18);
        font-weight: 700;
        color: $black;
        letter-spacing: rem(-0.5px);
    }

    .section-link {
        font-family: "Pretendard", sans-serif;
        color: $gray-700;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: rem(8); // 텍스트 간격
        height: auto;
        padding: 0;
        border: none;
        border-radius: 0;
        background-color: transparent;
        @include mixins.mobile-touch-effect; // 터치 피드백 추가

        // 전체보기 링크 화살표 (Full view arrow)
        &:after {
            content: "";
            display: block;
            width: rem(32);
            height: rem(32);
            border: 1.5px solid $gray-700;
            border-radius: rem(2);
            background: url('/assets/icons/fullview-arrow.svg') no-repeat center center;
            background-size: rem(20) rem(20);
            box-sizing: border-box;
            transition: all 0.2s;
        }

        &:hover:after {
            @include mixins.btn-active-styles;
        }
    }
}

// 상품 그리드 레이아웃
.product-grid-4,
.product-grid-2 {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: rem(4);
    align-items: stretch; // 카드 높이 균등화

    // MD 추천 상품 애니메이션 적용
    .md-rec-content.active & {
        animation: fadeInUp 0.4s ease-out forwards;
    }
}


@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(rem(20));
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}


// 주간 랭킹 섹션 (Weekly Ranking Section)
.weekly-ranking {
    padding-bottom: 0;

    .section-header {
        align-items: flex-start;

        .title-group {
            display: flex;
            flex-direction: column;
            gap: rem(4);

            .ranking-date {
                font-size: rem(13);
                color: $gray-500;
                font-weight: 400;
                letter-spacing: -0.02em;
            }
        }
    }

    .product-grid-2 {
        margin: 0 rem(-16);
    }

    .ranking-nav {
        display: flex;
        justify-content: space-between;
        padding: 0 rem(16);
        margin-bottom: rem(16);

        .nav-btn {
            width: rem(48);
            height: rem(48);
            border: 1.5px solid $gray-400;
            border-radius: rem(2);
            background: $white;
            display: flex;
            align-items: center;
            justify-content: center;
            color: $gray-700;
            border-color: $gray-700;
            @include mixins.mobile-touch-effect; // 터치 피드백 추가

            svg {
                width: rem(24);
                height: rem(24);
            }

            &:disabled {
                color: $gray-300;
                border-color: $gray-300;
            }
        }

        .page-count {
            display: flex;
            align-items: center;
            gap: rem(4);
            font-size: rem(16);
            font-weight: 500;
            color: $gray-500;
            font-family: $font-family-base;

            .current {
                color: $black; // 현재 페이지 (Current page)
                font-weight: 700;
            }

            .divider {
                display: inline-block;
                margin: 0 rem(2);
                color: $gray-300;
            }

            .total {
                color: $gray-500;
            }
        }
    }

    // 랭킹 캐러셀 (Ranking Carousel)
    .ranking-carousel-container {
        overflow: hidden;
        width: 100%;
    }

    .ranking-carousel-track {
        display: flex;
        width: 100%;
        align-items: flex-start;
        touch-action: pan-y;
        transition: transform 0.5s ease-in-out;
    }

    .ranking-list {
        width: 100%;
        min-width: 100%;
        flex-shrink: 0;
        box-sizing: border-box;

        // 비활성 슬라이드 숨김 (Hide inactive slides to prevent height issues)
        height: 0;
        overflow: hidden;

        // 활성 슬라이드 표시 (Show active slide)
        &.current {
            height: auto;
            overflow: visible;
        }
    }

    .ranking-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: rem(16) 0;

        .text-group {
            display: flex;
            align-items: center;
            gap: rem(8);

            .rank-num {
                font-size: rem(18);
                font-weight: 700;
                color: $black;
                min-width: rem(14);
            }

            .divider {
                width: rem(10);
                height: 1px;
                background-color: $gray-300;
            }

            .category-name {
                font-size: rem(16);
                font-weight: 700;
                color: $black;
            }

            .category-path {
                font-size: rem(13);
                color: $gray-500;
            }
        }

        .btn-toggle-rank {
            width: rem(32);
            height: rem(32);
            background: $white;
            border: 1.5px solid $gray-400;
            border-radius: rem(2);
            color: $black;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            @include mixins.mobile-touch-effect; // 터치 피드백 추가

            svg {
                transition: transform 0.2s;
            }

            &.active {
                background: $gray-700;
                border-color: $gray-700;
                color: $white;

                svg {
                    transform: rotate(180deg);
                }
            }
        }
    }

    .ranking-item {
        margin-left: rem(16);
        margin-right: rem(16);

        // 아코디언 활성 상태 (Expanded state)
        &.active {
            border-top: 2px solid $gray-700;
            border-bottom: 2px solid $gray-700;
            padding-bottom: rem(16);

            .ranking-header {
                border-bottom: none;
                margin-bottom: 0;
            }
        }

        padding-bottom: 0;

        .ranking-header {
            border-bottom: 1.5px solid $gray-100;
        }

        &.active .ranking-header {
            border-bottom: none;
        }

        .btn-more {
            width: 100%;
        }
    }

    .ranking-body {
        display: none;

        &.show {
            display: block;
        }
    }

}

// 더보기 버튼 공통 스타일 (Load more button common style)
.btn-more {
    width: calc(100% - rem(32));
    margin: rem(24) auto 0;
    height: rem(40);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: rem(4);
    border: 1.5px solid $gray-700;
    background: $white;
    border-radius: rem(2);
    font-size: rem(14);
    font-weight: 700;
    color: $gray-700;
    @include mixins.mobile-touch-effect; // 더보기 버튼 터치 피드백

    svg {
        width: rem(20);
        height: rem(20);
        fill: currentColor;
    }

    &:hover {
        background-color: $gray-50;
    }

}

// 모바일 메인 슬라이더 (Mobile Main Slider)
.mobile-main-slider {
    width: 100%;
    // margin-bottom: rem(24);
    overflow: hidden;
    padding-left: 0; // 내부 트랙으로 패딩 이동 (Move padding to track)
    // margin-left: rem(16);
    padding-bottom: rem(32);
    border-bottom: 0.5rem solid $gray-50;

    .slider-track {
        display: flex;
        gap: rem(8);
        margin-left: rem(16);
        padding-left: rem(16); // 왼쪽 시작 여백 (Left start margin)
        padding-right: rem(24); // 끝부분 여백 (End margin)
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;

        &::-webkit-scrollbar {
            display: none;
        }
    }

    .slide-item {
        flex: 0 0 calc(100vw - rem(40)); // 우측 24px 여백 확보 (Secure 24px right margin)
        scroll-snap-align: start;
        border-radius: rem(2);
        overflow: hidden;
        position: relative;
        background-color: $gray-50;
        aspect-ratio: 320/411;
        @include mixins.mobile-touch-effect($gray-50); // 슬라이드 터치 피드백

        .slider-card-img-wrap {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;

            img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                display: block;
            }
        }

        .slider-card-body {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: rem(96); // 텍스트 영역 고정 높이 (Fixed height)
            padding: rem(16) rem(20);
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: $white;

            // 배경색은 인라인 스타일로 개별 적용됨
            &.bg-snack {
                background-color: #65403a; // 다이제 브랜드 컬러 (Dr.You Brand Color)
            }

            &.bg-beverage {
                background-color: #5a493f; // 밸런스밀 브랜드 컬러 (Balance Meal Brand Color)

                .text-group .slider-title,
                .text-group .slider-desc {
                    color: $white; // 밝은 배경이므로 텍스트 색상 변경 (Dark text for light bg)
                }
            }

            &.bg-juice {
                background-color: #8d252c; // 주스 브랜드 컬러 (Juice Brand Color)

                .text-group .slider-title,
                .text-group .slider-desc {
                    color: $white; // 밝은 배경이므로 텍스트 색상 변경 (Dark text for light bg)
                }
            }

            &.bg-pasta {
                background-color: #0076be; // 파스타랑 브랜드 컬러 (Pasta Brand Color)
            }

            .text-group {
                display: flex;
                flex-direction: column;
                gap: rem(4);

                .slider-title {
                    font-size: rem(20);
                    margin: 0;
                    line-height: 1.3;
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                }

                .slider-desc {
                    font-size: rem(14);
                    margin: 0;
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                }
            }

            .slider-arrow {
                position: relative;
                top: rem(-8);
                width: rem(32);
                height: rem(32);
                background-color: rgba($white, 0.2);
                border-radius: rem(4);
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;

                svg {
                    width: rem(20);
                    height: rem(20);
                }
            }
        }
    }

    // 컨트롤러 영역 (Controller area)
    .slider-controller {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: rem(16);
        color: $black;
        font-family: $font-family-number;
        font-weight: 500;
        font-size: rem(14);

        &>*:not(.page-count) {
            width: rem(32) !important;
            height: rem(32) !important;
        }

        .page-count {
            display: flex;
            align-items: center;

            &>*:not(.divider) {
                display: flex;
                align-items: center;
                justify-content: center;
                width: rem(32) !important;
                height: rem(32) !important;
            }
        }

        button {
            background: none;
            border: none;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            width: rem(24);
            height: rem(24);
            color: $gray-300;
            @include mixins.mobile-touch-effect; // 컨트롤러 버튼 터치 피드백

            svg {
                width: rem(20);
                height: rem(20);
                fill: currentColor;

                path {
                    fill: $gray-700;
                }
            }

            &.active {
                color: $black;
            }
        }

        .page-count {
            display: flex;
            align-items: center;
            gap: rem(8);

            .current {
                color: $black;
                font-weight: 700;
            }

            .divider {
                width: rem(12);
                margin: 0 rem(8);
                height: 2px;
                background-color: $gray-300;
            }

            .total {
                color: $gray-300;
            }
        }
    }
}

// MD 추천 상품 (MD Recommendation)
.md-recommendation {
    .tab-menu {
        display: flex;
        gap: rem(4);
        padding-bottom: rem(12);
        // margin-bottom: rem(16);
        margin: rem(0) rem(16) rem(16);
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;

        &::-webkit-scrollbar {
            display: none;
        }

        .tab-item {
            padding: rem(8) rem(16);
            border-radius: rem(2);
            border: 0;
            // border: 1.5px solid $gray-200;
            background-color: $gray-50;
            color: $gray-600;
            font-size: rem(14);
            white-space: nowrap;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.2s;
            @include mixins.mobile-touch-effect; // 탭 버튼 터치 피드백

            &.active {
                background-color: $black;
                color: $white;
                border-color: $black;
                font-weight: 700;
            }
        }
    }

    .btn-more {
        svg {
            transform: rotate(-90deg);
        }
    }
}

// 브랜드관 (Brand Pavilion)
.brand-pavilion {
    .brand-story-list {
        display: flex;
        flex-direction: column;
        gap: rem(24);
        padding: 0 rem(16);
    }

    .brand-story-item {
        display: flex;
        flex-direction: column;
        gap: rem(16);

        .story-image {
            width: 100%;
            height: rem(240); // 고정 높이 (Fixed height)
            border-radius: rem(2);
            overflow: hidden;
            background-color: $gray-50;
            position: relative;

            img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                display: block;
            }
        }

        .story-content {
            display: flex;
            flex-direction: column;
            gap: rem(4);

            .brand-title {
                font-size: rem(16);
                font-weight: 700;
                color: $black;
            }

            .brand-desc {
                font-size: rem(14);
                color: $gray-300;
                letter-spacing: -0.02em;
                word-break: keep-all;

                display: -webkit-box;
                -webkit-line-clamp: 2;
                line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
                text-overflow: ellipsis;
            }
        }
    }

    .btn-more.btn-brand-more {
        width: 100%;
        margin-top: rem(16);
    }
}

// 팝콘 배너 (Popcorn Banner)
.popcorn-banner-wrapper {
    margin: rem(16) 0;
    overflow: hidden;

    .slider-track {
        display: flex;
        width: 100%;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        scrollbar-width: none;

        &::-webkit-scrollbar {
            display: none;
        }
    }

    .slide-item.banner-popcorn {
        flex: 0 0 100%;
        max-width: 100%;
        scroll-snap-align: start;
        background-color: #FFDE00;
        overflow: hidden;
        position: relative;
        height: rem(120);

        img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
    }

    .slider-controller {
        display: flex;
        align-items: center;
        justify-content: center;
        color: $black;
        font-family: $font-family-number;
        font-weight: 500;
        font-size: rem(14);

        &>*:not(.page-count) {
            width: rem(32) !important;
            height: rem(32) !important;
        }

        .page-count {
            display: flex;
            align-items: center;

            &>*:not(.divider) {
                display: flex;
                align-items: center;
                justify-content: center;
                width: rem(32) !important;
                height: rem(32) !important;
            }
        }

        button {
            background: none;
            border: none;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: $gray-300;
            @include mixins.mobile-touch-effect; // 컨트롤러 버튼 터치 피드백

            svg {
                width: rem(20);
                height: rem(20);
                fill: currentColor;

                path {
                    fill: $gray-700;
                }
            }

            &.active {
                color: $black;
            }
        }

        .page-count {
            display: flex;
            align-items: center;
            gap: rem(8);

            .current {
                color: $black;
                font-weight: 700;
            }

            .divider {
                width: rem(10);
                height: 2px;
                background-color: $gray-300;
            }

            .total {
                color: $gray-300;
            }
        }
    }
}